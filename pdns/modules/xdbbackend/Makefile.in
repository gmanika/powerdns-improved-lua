XDB_LIBS                = -ltdb
PDNS_HOME		= ../../pdns
INCLUDES                = -I$(PDNS_HOME) -I../..
CXXFLAGS                = @CXXFLAGS@

all: xdb-fill xdbbackend.o xtdb.o libxdbbackend.so

xdb-fill: xdb-fill.o  xtdb.o
	g++ $^ $(XDB_LIBS) -o xdb-fill

distclean: clean

clean:
	rm -f *.o *.so *~ *.d

PACKAGE = @PACKAGE@
VERSION = @VERSION@
DISTFILES=*.cc *.hh Makefile.in OBJECTFILES OBJECTLIBS

top_distdir = ../..
distdir = $(top_distdir)/$(PACKAGE)-$(VERSION)
exec_prefix = @exec_prefix@

distdir: $(DISTFILES)
	@for file in $(DISTFILES); do \
	  if test -f $$file; then d=.; else d=$(srcdir); fi; \
	  dir=`echo "$$file" | sed -e 's,/[^/]*$$,,'`; \
	  if test "$$dir" != "$$file" && test "$$dir" != "."; then \
	    $(mkinstalldirs) "$(distdir)/$$dir"; \
	  fi; \
	  if test -d $$d/$$file; then \
	    cp -pR $$d/$$file $(distdir) \
	    || exit 1; \
	  else \
	    test -f $(distdir)/$$file \
	    || cp -p $$d/$$file $(distdir)/$$file \
	    || exit 1; \
	  fi; \
	done

.cc.o:
	g++ -MD -g -c $(CXXFLAGS) $(CPPFLAGS) $(INCLUDES) $<

libxdbbackend.so: xdbbackend.o xtdb.o
	g++ -shared $^ $(XDB_LIBS) -o $@

mkinstalldirs = $(SHELL) @top_srcdir@/mkinstalldirs

prefix=@prefix@
install:
	$(mkinstalldirs) $(DESTDIR)@libdir@
	install -s libxdbbackend.so $(DESTDIR)@libdir@
	$(mkinstalldirs) $(DESTDIR)@bindir@
	install -s xdb-fill $(DESTDIR)@bindir@

